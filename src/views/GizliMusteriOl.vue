<template>
  <div class="gizli-musteri-container">
    <!-- 1. Adım: Gizli Müşteri Sözleşmesi -->
    <div v-if="currentStep === 1">
      <h1>GİZLİ MÜŞTERİ SÖZLEŞMESİ</h1>
      <div class="scrollable-text">
        <p>
          X Audit’nin projelerinde görev alacak tüm Gizli Müşteriler, aşağıda detaylandırılan
          <span class="important">Etik Davranış Kuralları’na</span> uyacaklarını beyan ve taahhüt ederler:
        </p>
        <p>
          X Audit’de Gizli Müşteri olarak üstlendiğim görevlerde;
          <span class="important">Tüm ziyaretleri elimden gelen en iyi şekilde, doğruluk ve dürüstlük ilkeleri çerçevesinde gerçekleştireceğimi,</span>
          Gizli Müşteri çalışmaları ile ilgili olarak X Audit tarafından uygulanacak ve projeler öncesinde katılmam istenecek her türlü eğitim ve sınava katılacağımı, bu sınavlardan olumlu sonuçlar aldığım takdirde projelerde görev alabileceğimi,
          <span class="important">Gizli Müşteri çalışmaları hakkındaki genel ve proje bazındaki eğitimleri dikkatle dinleyeceğimi / izleyeceğimi,</span> görevlendirileceğim projeye başlamadan önce tarafıma iletilen eğitim malzemelerini eksiksiz olarak okuyacağımı, anlamadığım bir şey olursa bunu netleştirmeden işe başlamayacağımı, eğitim almadan yapacağım ziyaretlerin geçerli sayılmayacağını,
          Eğitim bilgilendirmeleri sırasında bana verilmiş olan sözlü ve yazılı bilgileri X Audit’in izni olmadan üçüncü şahıslarla paylaşmayacağımı, eğitimler sırasında dağıtılan dokümanlardan hiçbir ortamda hiçbir kopya oluşturmayacağımı,
          <span class="important">Benden yazılı ya da sözlü olarak istenmiş olan her şeyin bir nedeni olduğunu kabul ederek, mantıksız bulduğum konular da dahil olmak üzere verilen direktiflerin aksi hiçbir davranışta bulunmayacağımı,</span>
          Proje başlangıcında ya da sırasında tarafıma iletilecek zaman planına birebir uyacağımı, ziyaretleri bu plan doğrultusunda gerçekleştireceğimi ve formlarımı proje yetkililerine zamanında ya da zamanından önce ulaştıracağımı,
          Tüm gizlilik anlaşmalarına uyacağımı,
          Herhangi bir nedenden dolayı bir ziyareti gerçekleştiremeyeceğim durumlarda X Audit’i anında haberdar edeceğimi,
          X Audit yetkililerinin bana ulaşabilmesi için saha çalışması sırasında cep telefonumu sürekli olarak açık tutacağımı, cep telefonuyla ulaşılamadığım durumlarda proje yetkililerini e-posta, normal telefon, faks, vb. araçlarla düzenli olarak haberdar edeceğimi,
          Çalışma sırasında topladığım dokümanların hepsini X Audit’e göndereceğimi, tutmuş olduğum notları, müşterilerden gelebilecek soruları cevaplayabilmek amacıyla en az 60 gün boyunca saklayacağımı,
          Başka firmalar için Gizli Müşteri olarak çalışan kişilerin, imzaladıkları gizlilik anlaşmalarını ihlal etmelerini istemeyeceğimi ve onları buna teşvik etmeyeceğimi,
          Herhangi bir yayın organında X Audit, müşteriler veya gizli müşteriler aleyhinde şikayette bulunmayacağımı,
          X Audit’in hangi müşteriler için gizli müşteri hizmeti verdiği hakkında hiç kimseyle bilgi paylaşmayacağımı,
          Gizli müşteri projelerinde ödenen ücretler ve karşılanan giderlerle ilgili hiç kimseyle bilgi paylaşmayacağımı,
          Gizli Müşteri olarak yaptığım ziyaretler hakkında birinci dereceden yakınlarım da dahil olmak üzere kimseye bilgi vermeyeceğimi, firma adı belirtmeyeceğimi, gözlemlerimi ve tecrübelerimi kimse ile paylaşmayacağımı,
          Gizli müşteri ziyaretleri sırasında, alkol, uyuşturucu gibi zararlı maddeler ile gözlem ve denetleme yeteneklerimi kısıtlayabilecek niteliklere sahip hiçbir reçeteli/reçetesiz ilacı kullanmayacağımı,
          X Audit’nin onayı olmadan hiçbir müşteriyle doğrudan irtibata geçmeyeceğimi,
          Gerçekleştireceğim ziyaretler sırasında denetlediğim noktadaki işlem süreçlerindeki normal iş akışlarını bozmayacağımı,
          Gerçekleştireceğim herhangi bir Gizli Müşteri ziyareti sırasında tarafıma Gizli Müşteri olup olmadığım sorulduğu takdirde konudan tamamen habersiz davranarak kimliğimin ortaya çıkmamasını sağlayacağımı, X Audit tarafından aksi belirtilmedikçe Gizli Müşteri kimliğimi denetlediğim noktalarda açıklamayacağımı,
          Benim, ailemin ya da yakın arkadaşlarımın geçmişte ya da halihazırda çalıştığı firmalar nezdinde yürütülecek Gizli Müşteri projelerinde görev almayacağımı,
          Çalışma sırasında gerçekleştireceğim giderler konusunda, proje başlangıcında tarafıma iletilecek bütçe dışında hiçbir talepte bulunmayacağımı ve giderlerimle ilgili her türlü belgeyi istendiği takdirde X Audit’ye ibraz edeceğimi,
          X Audit’nin bilgisi ve onayı olmadan bana verilen işleri başkasına devretmeyeceğimi, kendi yerime başka kimseyi çalıştırmayacağımı, X Audit tarafından aksi bildirilmedikçe tüm ziyaretleri tek başıma yapacağımı,
          Dolduracağım formlardaki bilgilerin tarafımca yapılan gerçek gözlemlere ve/veya görüşmelere dayanan doğru bilgiler olacağını,
          X Audit’ye vermiş olduğum adres, telefon ve diğer kişisel bilgilerin doğru olduğunu, bu bilgilerde herhangi bir değişiklik olduğunda X Audit’i derhal haberdar edeceğimi,
          X Audit tarafından atandığım bir projede görev aldığım süre boyunca eş zamanlı olarak, başka bir şirkette, aynı sektörde hizmet veren başka bir firmanın benzer bir işinde çalışmayacağımı,
          Benden beklenenleri tam olarak yerine getirmeden, ziyaret formlarını eksiksiz olarak teslim etmeden ve kontrol sonuçları alınmadan herhangi bir ödeme talep etmeyeceğimi önceden taahhüt ederim.
          Bu belgeyi onaylayarak, bu sözleşme çerçevesinde detaylandırılan dürüstlük, profesyonellik, hakkaniyet ve gizlilik ilkelerini okuduğumu, anladığımı ve uygulamayı kabul ettiğimi, sözleşmeyi ihlal eden herhangi bir davranışta bulunduğum takdirde X Audit’den hiçbir alacak talep etmeyeceğimi kabul ederim.
        </p>
      </div>

      <label>
        <input type="checkbox" v-model="sozlesmeOnay" />
        Yukarıdaki sözleşmeyi okudum, anladım ve kurallara uyacağımı taahhüt ettim.
      </label>

      <button :disabled="!sozlesmeOnay" @click="nextStep">İleri</button>
    </div>

    <!-- 2. Adım: Gizli Müşteri Kabul Metni -->
    <div v-if="currentStep === 2">
      <h1>GİZLİ MÜŞTERİ KABUL METNİ</h1>
      <div class="scrollable-text">
        <p>
          Yürüteceğim gizli müşteri çalışması esnasında, gizli müşteri olarak gideceğim işletmenin genel alanlarında kaydedilecek
          <span class="important">güvenlik kameraları görüntülerimin</span> ve işletme yetkilileri ile işletme telefonları üzerinden gerçekleştirdiğim telefon görüşmelerine ait
          <span class="important">ses kayıtlarının paylaşılmasına</span> ve veritabanına kaydetmiş olduğum tüm iletişim kanalları üzerinden benimle iletişime geçilmesine
          açık rıza gösterdiğimi kabul ve beyan ederim.
        </p>
        <p>
          1.a) Kişisel Verilerin Elde Edilme Yöntemleri ve Hukuki Sebepleri
          Kişisel verileriniz, elektronik veya fiziki ortamda toplanmaktadır. İşbu Aydınlatma Metni'nde belirtilen hukuki sebeplerle toplanan
          <span class="important">kişisel verileriniz Kanun'un 5. ve 6. maddelerinde</span> belirtilen kişisel veri işleme şartları çerçevesinde işlenebilmekte ve
          paylaşılabilmektedir.
          1.b) Kişisel Verilerin İşleme Amaçları
          Kişisel verileriniz, Kanun'un 5. ve 6. maddelerinde belirtilen kişisel veri işleme şartları çerçevesinde X Audit tarafından sunulan ürün ve hizmetlerin ilgili kişilerin beğeni, kullanım alışkanlıkları, profil bilgileri ve ihtiyaçlarına göre özelleştirilerek ilgili kişilere önerilmesi, teklif edilmesi ve tanıtılması için gerekli olan aktivitelerin planlanması ve icrası, X Audit tarafından sunulan ürün ve hizmetlerden ilgili kişileri faydalandırmak için gerekli çalışmaların iş birimleri tarafından yapılması ve ilgili iş süreçlerinin yürütülmesi, X Audit tarafından yürütülen ticari faaliyetlerin gerçekleştirilmesi için gerekli çalışmaların yapılması ve buna bağlı iş süreçlerinin yürütülmesi, X Audit'in ticari ve/veya iş stratejilerinin planlanması ve icrası ve X Audit'in ve X Audit ile iş ilişkisi içerisinde olan ilgili kişilerin hukuki, teknik ve ticari-iş güvenliğinin temini amaçlarıyla işlenmektedir.
          1.c) Kişisel Verilerin Paylaşılabileceği Taraflar ve Paylaşım Amaçları
          Kişisel verileriniz, Kanun'un 8. ve 9. maddelerinde belirtilen kişisel veri işleme şartları ve amaçları çerçevesinde, X Audit tarafından sunulan ürün ve hizmetlerin ilgili kişilerin beğeni, kullanım alışkanlıkları ve ihtiyaçlarına göre özelleştirilerek ilgili kişilere önerilmesi, teklif edilmesi ve tanıtılması için gerekli olan aktivitelerin planlanması ve icrası, X Audit tarafından sunulan ürün ve hizmetlerden ilgili kişileri faydalandırmak için gerekli çalışmaların yapılması ve iş süreçlerinin yürütülmesi, X Audit tarafından yürütülen ticari faaliyetlerin gerçekleştirilmesi için gerekli çalışmaların yapılması ve buna bağlı iş süreçlerinin yürütülmesi, X Audit'in ticari ve/veya iş stratejilerinin planlanması ve icrası ve X Audit'in ve iş ilişkisi içerisinde olduğu kişilerin hukuki, teknik ve ticari-iş güvenliğinin temini amaçlarıyla paylaşılabilecektir.
        </p>
      </div>

      <label>
        <input type="checkbox" v-model="kabulOnay" />
        Yukarıdaki bilgileri onayladım ve kabul ettim.
      </label>

      <button :disabled="!kabulOnay" @click="nextStep">İleri</button>
    </div>

    <!-- 3. Adım: Kamera ve Fotoğraf Çekme -->
    <div v-if="currentStep === 3">
      <h1>KİŞİSEL FOTOĞRAFIMI ÇEK</h1>

      <!-- Video önizlemesi (Kamerayı açtığında video gözükecek) -->
      <video ref="video" class="video-preview" v-show="cameraActive" autoplay></video>
      <canvas ref="canvas" class="canvas-preview" style="display: none;"></canvas>

      <!-- Kamera açma butonu -->
      <button v-if="!cameraActive" @click="startCamera">Kamerayı Aç</button>

      <!-- Fotoğraf çekme butonu, kamera aktifse görünür -->
      <button v-if="cameraActive" @click="capturePhoto">Fotoğrafı Çek</button>

      <!-- Çekilen fotoğraf gösterimi -->
      <div v-if="photo">
        <h2>Çekilen Fotoğraf</h2>
        <img :src="photo" alt="Çekilen fotoğraf" />
      </div>

      <!-- "İleri" butonu fotoğraf çekildikten sonra aktif olacak -->
      <button :disabled="!photo" @click="nextStep">İleri</button>
    </div>

    <!-- 4. Adım: Kişisel Bilgiler -->
    <div v-if="currentStep === 4">
      <h1>KİŞİSEL BİLGİLER</h1>

      <label>
        İsim:
        <input type="text" v-model="personalInfo.isim" required />
      </label>

      <label>
        Soyad:
        <input type="text" v-model="personalInfo.soyad" required />
      </label>

      <label>
        Doğum Yeri:
        <select v-model="personalInfo.dogumYeri" required>
          <option value="">Seçiniz</option>
          <option v-for="sehir in sehirler" :key="sehir" :value="sehir">{{ sehir }}</option>
        </select>
      </label>

      <label>
        Doğum Tarihi (gg.aa.yyyy):
        <input
          type="text"
          v-model="personalInfo.dogumTarihi"
          placeholder="gg.aa.yyyy"
          @input="validateDate"
          required
        />
      </label>
      <span v-if="!dateIsValid" class="error-message">Lütfen geçerli bir tarih formatı giriniz (gg.aa.yyyy).</span>

      <label>
        Medeni Durum:
        <select v-model="personalInfo.medeniDurum" required>
          <option value="">Seçiniz</option>
          <option value="EVLİ">Evli</option>
          <option value="BEKAR">Bekar</option>
          <option value="BOŞANMIŞ">Boşanmış</option>
        </select>
      </label>

      <label>
        18 yaşından küçük kaç çocuğunuz var:
        <select v-model="personalInfo.cocukSayisi" required>
          <option value="">Seçiniz</option>
          <option v-for="n in 16" :key="n - 1" :value="n - 1">{{ n - 1 }}</option>
        </select>
      </label>

      <!-- "İleri" butonu tüm alanlar doldurulduktan sonra aktif olacak -->
      <button :disabled="!isPersonalInfoComplete" @click="nextStep">İleri</button>
    </div>

    <!-- 5. Adım: İletişim Bilgileri -->
    <div v-if="currentStep === 5">
      <h1>İLETİŞİM BİLGİLERİ</h1>

      <!-- İletişim Bilgileri - Adres -->
      <h2>İletişim Bilgileri - Adres</h2>

      <label>
        Açık Adres:
        <textarea v-model="contactInfo.acikAdres" :maxlength="375" required></textarea>
      </label>

      <label>
        Semt:
        <input type="text" v-model="contactInfo.semt" :maxlength="100" required />
      </label>

      <label>
        İl:
        <select v-model="contactInfo.il" @change="loadIlceler" required>
          <option value="">Seçiniz</option>
          <option v-for="sehir in sehirler" :key="sehir" :value="sehir">{{ sehir }}</option>
        </select>
      </label>

      <label>
        İlçe:
        <select v-model="contactInfo.ilce" required>
          <option value="">Seçiniz</option>
          <option v-for="ilce in ilceler" :key="ilce" :value="ilce">{{ ilce }}</option>
        </select>
      </label>

      <!-- İletişim Bilgileri - Dijital -->
      <h2>İletişim Bilgileri - Dijital</h2>

      <label>
        Ev Telefonu:
        <input type="text" v-model="contactInfo.evTelefonu" :maxlength="15" />
      </label>

      <label>
        İş Telefonu:
        <input type="text" v-model="contactInfo.isTelefonu" :maxlength="15" />
      </label>

      <label>
        Mobil Telefonu:
        <input type="text" v-model="contactInfo.mobilTelefon" :maxlength="15" required />
      </label>

      <label>
        E-mail:
        <input
          type="email"
          v-model="contactInfo.email"
          :maxlength="100"
          @paste.prevent
          required
        />
      </label>

      <label>
        E-mail (Tekrar):
        <input
          type="email"
          v-model="contactInfo.emailConfirm"
          :maxlength="100"
          @paste.prevent
          required
        />
      </label>
      <span v-if="!emailsMatch" class="error-message">E-mail adresleri eşleşmiyor.</span>

      <!-- "İleri" butonu tüm alanlar doldurulduktan sonra aktif olacak -->
      <button :disabled="!isContactInfoComplete" @click="nextStep">İleri</button>
    </div>

    <!-- 6. Adım: Eğitim ve İş Bilgileri -->
    <div v-if="currentStep === 6">
      <h1>EĞİTİM VE İŞ BİLGİLERİ</h1>

      <label>
        Eğitim Durumu:
        <select v-model="educationInfo.egitimDurumu" required>
          <option value="">Seçiniz</option>
          <option value="İLKÖĞRETİM">İlköğretim</option>
          <option value="LİSE">Lise</option>
          <option value="ÖN LİSANS">Ön Lisans</option>
          <option value="LİSANS">Lisans</option>
          <option value="YÜKSEK LİSANS">Yüksek Lisans</option>
          <option value="DOKTORA">Doktora</option>
        </select>
      </label>

      <label>
        Bildiğiniz Yabancı Diller (Seviye ile birlikte):
        <input
          type="text"
          v-model="educationInfo.bildigiYabanciDiller"
          maxlength="100"
          placeholder="Örneğin: İngilizce (İyi), Almanca (Orta)"
          required
        />
      </label>

      <label>
        Üniversite Bilgileri:
        <textarea
          v-model="educationInfo.universiteBilgileri"
          maxlength="225"
          placeholder="Üniversitenizin ismi ve okuduğunuz bölüm"
          required
        ></textarea>
      </label>

      <label>
        Çalışma Durumu:
        <select v-model="educationInfo.calismaDurumu" required>
          <option value="">Seçiniz</option>
          <option value="ÖĞRENCİ">Öğrenci</option>
          <option value="EV HANIMI">Ev Hanımı</option>
          <option value="İŞSİZ">İşsiz</option>
          <option value="EMEKLİ">Emekli</option>
          <option value="ÜCRETLİ">Ücretli</option>
          <option value="KENDİ İŞİNDE ÇALIŞIYOR">Kendi İşinde Çalışıyor</option>
        </select>
      </label>

      <label>
        Çalıştığınız Sektör:
        <input
          type="text"
          v-model="educationInfo.calistigiSektor"
          maxlength="100"
          placeholder="Örneğin: Bilişim, Sağlık"
          required
        />
      </label>

      <!-- "İleri" butonu tüm alanlar doldurulduktan sonra aktif olacak -->
      <button :disabled="!isEducationInfoComplete" @click="nextStep">İleri</button>
    </div>

    <!-- 7. Adım: Özel Bilgiler -->
    <div v-if="currentStep === 7">
      <h1>ÖZEL BİLGİLER</h1>

      <label>
        Boy-Beden Bilgileri:
        <input
          type="text"
          v-model="ozelBilgiler.boyBedenBilgileri"
          maxlength="100"
          placeholder="Örneğin: 168 cm - XL"
          required
        />
      </label>

      <label>
        Gözlük Kullanıyor mu?
        <select v-model="ozelBilgiler.gozlukKullaniyorMu" required>
          <option value="">Seçiniz</option>
          <option value="Evet">Evet</option>
          <option value="Hayır">Hayır</option>
        </select>
      </label>

      <label>
        Lens Kullanıyor mu?
        <select v-model="ozelBilgiler.lensKullaniyorMu" required>
          <option value="">Seçiniz</option>
          <option value="Evet">Evet</option>
          <option value="Hayır">Hayır</option>
        </select>
      </label>

      <label>
        Sigara Kullanıyor mu?
        <select v-model="ozelBilgiler.sigaraKullaniyorMu" required>
          <option value="">Seçiniz</option>
          <option value="Evet">Evet</option>
          <option value="Hayır">Hayır</option>
        </select>
      </label>

      <label>
        Ehliyet Var mı?
        <select v-model="ozelBilgiler.ehliyetVarMi" required>
          <option value="">Seçiniz</option>
          <option value="Evet">Evet</option>
          <option value="Hayır">Hayır</option>
        </select>
      </label>

      <label>
        Aktif Araç Kullanıyor mu?
        <select v-model="ozelBilgiler.aktifAracKullaniyorMu" required>
          <option value="">Seçiniz</option>
          <option value="Evet">Evet</option>
          <option value="Hayır">Hayır</option>
        </select>
      </label>

      <label>
        Otomobil Var mı?
        <select v-model="ozelBilgiler.otomobilVarMi" required>
          <option value="">Seçiniz</option>
          <option value="Evet">Evet</option>
          <option value="Hayır">Hayır</option>
        </select>
      </label>

      <label>
        Çekirdek Aile Geliri:
        <input
          type="number"
          v-model="ozelBilgiler.cekirdekAileGeliri"
          maxlength="12"
          placeholder="Örneğin: 50000"
          required
          min="0"
        />
      </label>

      <label>
        Hobiler:
        <input
          type="text"
          v-model="ozelBilgiler.hobiler"
          maxlength="255"
          placeholder="Hobilerinizi yazınız."
          required
        />
      </label>

      <!-- "İleri" butonu tüm alanlar doldurulduktan sonra aktif olacak -->
      <button :disabled="!isOzelBilgilerComplete" @click="nextStep">İleri</button>
    </div>

    <!-- 8. Adım: Çalışma Bilgileri ve Banka Bilgileri -->
    <div v-if="currentStep === 8">
      <h1>ÇALIŞMA BİLGİLERİ</h1>

      <label>
        Daha Önce Gizli Müşteri Olarak Görev Aldınız mı? (Kaç Kez):
        <input
          type="number"
          v-model="calismaBilgileri.dahaOnceGizliMusteri"
          maxlength="5"
          placeholder="Örneğin: 3"
          required
          min="0"
          max="99999"
        />
        <span v-if="calismaBilgileri.dahaOnceGizliMusteri === '' && currentStep === 8" class="error-message">Bu alan zorunludur.</span>
      </label>

      <label>
        Çalışabileceğiniz Zaman Dilimi:
        <input
          type="text"
          v-model="calismaBilgileri.calisabilecegiZamanDilimi"
          placeholder="Örneğin: 08.00-12.00 Çarşamba, 12.00-16.00 Cuma, Hafta Sonu: 17.00-23.00"
          required
        />
        <span v-if="!calismaBilgileri.calisabilecegiZamanDilimi.trim() && currentStep === 8" class="error-message">Bu alan zorunludur.</span>
      </label>

      <label>
        Çalışabileceğiniz Bölgeler:
        <input
          type="text"
          v-model="calismaBilgileri.calisabilecegiBolgeler"
          placeholder="Örneğin: İstanbul-Avrupa, İstanbul-Asya, Tekirdağ, Mersin, Gebze"
          required
        />
        <span v-if="!calismaBilgileri.calisabilecegiBolgeler.trim() && currentStep === 8" class="error-message">Bu alan zorunludur.</span>
      </label>

      <!-- Alıcı Bilgileri -->
      <h2>Alıcı Bilgileri - Banka Bilgileri</h2>
      <p class="optional-note">Bu alan zorunlu değildir, ancak hakedişlerin yatırılabilmesi için alınmaktadır.</p>

      <label>
        Tam Alıcı Adı:
        <input
          type="text"
          v-model="bankaBilgileri.tamAliciAdi"
          placeholder="Banka Kartının üzerindeki isim"
          :required="isBankaBilgileriRequired"
        />
        <span v-if="!bankaBilgileri.tamAliciAdi.trim() && isBankaBilgileriRequired" class="error-message">Tam Alıcı Adı zorunludur.</span>
      </label>

      <label>
        IBAN:
        <input
          type="text"
          v-model="bankaBilgileri.iban"
          placeholder="TRxxxxxxxxxxxxxxxxxxxxxxxxxx"
          :required="isBankaBilgileriRequired"
          minlength="26"
          maxlength="26"
          @input="validateIban"
        />
      </label>
      <span v-if="!ibanIsValid && bankaBilgileri.iban" class="error-message">IBAN 26 karakterli olmalı ve 'TR' ile başlamalıdır.</span>

      <label>
        Kimlik Numarası:
        <input
          type="text"
          v-model="bankaBilgileri.kimlikNumarasi"
          placeholder="11 haneli kimlik numarası"
          :required="isBankaBilgileriRequired"
          minlength="11"
          maxlength="11"
          @input="validateKimlikNumarasi"
        />
      </label>
      <span v-if="!kimlikNumarasiIsValid && bankaBilgileri.kimlikNumarasi" class="error-message">Kimlik Numarası 11 haneli olmalıdır.</span>

      <!-- "Gönder" butonu tüm alanlar doldurulduktan sonra aktif olacak -->
      <button :disabled="!isCalismaBilgileriComplete || !isBankaBilgileriValid" @click="submitForm">Gönder</button>
    </div>
  </div>
</template>
<script>
import axios from 'axios';
import { v4 as uuidv4 } from 'uuid'; // UUID paketini içe aktarın

export default {
  data() {
    return {
      sozlesmeOnay: false, // Gizli müşteri sözleşmesi onayı
      kabulOnay: false, // Gizli müşteri kabul metni onayı
      photo: null, // Çekilen fotoğrafı tutacak değişken
      currentStep: 1, // Adım takipçisi
      cameraActive: false, // Kameranın açık olup olmadığını kontrol eder
      videoStream: null, // Kamera akışını tutacak değişken
      personalInfo: {
        isim: "",
        soyad: "",
        dogumYeri: "",
        dogumTarihi: "",
        medeniDurum: "",
        cocukSayisi: "",
      },
      contactInfo: {
        acikAdres: "",
        semt: "",
        il: "",
        ilce: "",
        evTelefonu: "",
        isTelefonu: "",
        mobilTelefon: "",
        email: "",
        emailConfirm: "",
      },
      educationInfo: { // 6. Adım için yeni veri yapısı
        egitimDurumu: "",
        bildigiYabanciDiller: "",
        universiteBilgileri: "",
        calismaDurumu: "",
        calistigiSektor: "",
      },
      ozelBilgiler: { // 7. Adım için yeni veri yapısı
        boyBedenBilgileri: "",
        gozlukKullaniyorMu: "",
        lensKullaniyorMu: "",
        ehliyetVarMi: "",
        aktifAracKullaniyorMu: "",
        otomobilVarMi: "",
        cekirdekAileGeliri: "",
        hobiler: "",
        sigaraKullaniyorMu: "",
      },
      calismaBilgileri: { // 8. Adım için yeni veri yapısı
        dahaOnceGizliMusteri: "",
        calisabilecegiZamanDilimi: "",
        calisabilecegiBolgeler: "",
      },
      bankaBilgileri: { // 8. Adım için Banka Bilgileri
        tamAliciAdi: "",
        iban: "",
        kimlikNumarasi: "",
      },
      sehirler: [
        "Adana", "Adıyaman", "Afyonkarahisar", "Ağrı", "Amasya", "Ankara", "Antalya",
        "Artvin", "Aydın", "Balıkesir", "Bilecik", "Bingöl", "Bitlis", "Bolu",
        "Burdur", "Bursa", "Çanakkale", "Çankırı", "Çorum", "Denizli", "Diyarbakır",
        "Edirne", "Elazığ", "Erzincan", "Erzurum", "Eskişehir", "Gaziantep",
        "Giresun", "Gümüşhane", "Hakkâri", "Hatay", "Isparta", "Mersin", "İstanbul",
        "İzmir", "Kars", "Kastamonu", "Kayseri", "Kırklareli", "Kırşehir", "Kocaeli",
        "Konya", "Kütahya", "Malatya", "Manisa", "Kahramanmaraş", "Mardin", "Muğla",
        "Muş", "Nevşehir", "Niğde", "Ordu", "Rize", "Sakarya", "Samsun", "Siirt",
        "Sinop", "Sivas", "Tekirdağ", "Tokat", "Trabzon", "Tunceli", "Şanlıurfa",
        "Uşak", "Van", "Yozgat", "Zonguldak", "Aksaray", "Bayburt", "Karaman",
        "Kırıkkale", "Batman", "Şırnak", "Bartın", "Ardahan", "Iğdır", "Yalova",
        "Karabük", "Kilis", "Osmaniye", "Düzce"
      ],
      ilceler: [], // Seçilen ilin ilçeleri
      dateIsValid: true, // Doğum tarihi doğrulama durumu
      ibanIsValid: true, // IBAN doğrulama durumu
      kimlikNumarasiIsValid: true, // Kimlik Numarası doğrulama durumu
    };
  },
  computed: {
    isPersonalInfoComplete() {
      const { isim, soyad, dogumYeri, dogumTarihi, medeniDurum, cocukSayisi } = this.personalInfo;
      return (
        isim.trim() !== "" &&
        soyad.trim() !== "" &&
        dogumYeri.trim() !== "" &&
        dogumTarihi.trim() !== "" &&
        this.isValidDate(dogumTarihi) &&
        medeniDurum.trim() !== "" &&
        cocukSayisi !== "" &&
        this.dateIsValid
      );
    },
    isContactInfoComplete() {
      const {
        acikAdres,
        semt,
        il,
        ilce,
        mobilTelefon,
        email,
        emailConfirm,
      } = this.contactInfo;
      return (
        acikAdres.trim() !== "" &&
        semt.trim() !== "" &&
        il.trim() !== "" &&
        ilce.trim() !== "" &&
        mobilTelefon.trim() !== "" &&
        email.trim() !== "" &&
        emailConfirm.trim() !== "" &&
        this.emailsMatch
      );
    },
    isEducationInfoComplete() { // 6. Adımın doğrulaması
      const {
        egitimDurumu,
        bildigiYabanciDiller,
        universiteBilgileri,
        calismaDurumu,
        calistigiSektor,
      } = this.educationInfo;
      return (
        egitimDurumu.trim() !== "" &&
        bildigiYabanciDiller.trim() !== "" &&
        universiteBilgileri.trim() !== "" &&
        calismaDurumu.trim() !== "" &&
        calistigiSektor.trim() !== ""
      );
    },
    isOzelBilgilerComplete() { // 7. Adımın doğrulaması
      const {
        boyBedenBilgileri,
        gozlukKullaniyorMu,
        lensKullaniyorMu,
        ehliyetVarMi,
        aktifAracKullaniyorMu,
        otomobilVarMi,
        cekirdekAileGeliri,
        hobiler,
        sigaraKullaniyorMu
      } = this.ozelBilgiler;
      return (
        boyBedenBilgileri.trim() !== "" &&
        gozlukKullaniyorMu.trim() !== "" &&
        lensKullaniyorMu.trim() !== "" &&
        ehliyetVarMi.trim() !== "" &&
        aktifAracKullaniyorMu.trim() !== "" &&
        otomobilVarMi.trim() !== "" &&
        cekirdekAileGeliri.toString().trim() !== "" &&
        hobiler.trim() !== "" &&
        sigaraKullaniyorMu.trim() !== "" // Burada virgül eksikti
      );
    },
    isCalismaBilgileriComplete() { // 8. Adımın doğrulaması
      const {
        dahaOnceGizliMusteri,
        calisabilecegiZamanDilimi,
        calisabilecegiBolgeler,
      } = this.calismaBilgileri;
      return (
        dahaOnceGizliMusteri !== "" &&
        !isNaN(dahaOnceGizliMusteri) &&
        calisabilecegiZamanDilimi.trim() !== "" &&
        calisabilecegiBolgeler.trim() !== ""
      );
    },
    isBankaBilgileriValid() { // 8. Adımın Banka Bilgileri doğrulaması
      const { tamAliciAdi, iban, kimlikNumarasi } = this.bankaBilgileri;
      // Banka Bilgileri zorunlu değil, ancak doldurulursa doğrulanmalı
      if (tamAliciAdi.trim() === "" && iban.trim() === "" && kimlikNumarasi.trim() === "") {
        return true; // Her şey boşsa geçerli
      }
      return (
        tamAliciAdi.trim() !== "" &&
        this.ibanIsValid &&
        this.kimlikNumarasiIsValid
      );
    },
    emailsMatch() {
      return this.contactInfo.email === this.contactInfo.emailConfirm;
    },
    isBankaBilgileriRequired() {
      // Banka Bilgileri alanları zorunlu değil, sadece bazı koşullar altında zorunlu olabilir
      // Burada herhangi bir koşul eklemedik, bu nedenle sadece dolu olup olmadığını kontrol ediyoruz
      return this.bankaBilgileri.tamAliciAdi !== "" ||
             this.bankaBilgileri.iban !== "" ||
             this.bankaBilgileri.kimlikNumarasi !== "";
    },
  },
  methods: {
    nextStep() {
      if (this.currentStep === 3) {
        this.stopCamera(); // 3. adımdan geçerken kamerayı kapat
      }
      if (this.currentStep < 8) {
        this.currentStep++; // Bir sonraki adıma geç
      }
    },
    async startCamera() {
      // Vue'nun DOM güncellemesini tamamlamasını bekleyin
      await this.$nextTick();

      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        this.videoStream = stream;
        if (this.$refs.video) {
          this.$refs.video.srcObject = stream;
          this.cameraActive = true; // Kamera aktif oldu
        } else {
          console.error("Video referansına erişilemedi.");
        }
      } catch (err) {
        console.error("Kamera erişimi başarısız: ", err);
        alert("Kamera erişimi başarısız oldu. Lütfen izinleri kontrol edin veya farklı bir tarayıcı deneyin.");
      }
    },
    capturePhoto() {
      // Fotoğrafı yakala ve göster
      const canvas = this.$refs.canvas;
      const video = this.$refs.video;
      if (video && canvas) {
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext("2d").drawImage(video, 0, 0, canvas.width, canvas.height);
        this.photo = canvas.toDataURL("image/jpeg");

        // Fotoğraf çekildikten sonra kamerayı kapat
        this.stopCamera();
      } else {
        console.error("Video veya Canvas referansına erişilemedi.");
      }
    },
    stopCamera() {
      if (this.videoStream) {
        this.videoStream.getTracks().forEach((track) => track.stop());
        this.videoStream = null;
        this.cameraActive = false; // Kamera kapandı
      }
    },
    isValidDate(dateString) {
      // gg.aa.yyyy formatında tarih kontrolü
      const regex = /^([0-2][0-9]|3[0-1])\.([0][1-9]|1[0-2])\.(19|20)\d{2}$/;
      return regex.test(dateString);
    },
    validateDate() {
      this.dateIsValid = this.isValidDate(this.personalInfo.dogumTarihi);
    },
    loadIlceler() {
        // Seçilen ile göre ilçeleri yükle
    const ilcelerData = {
    "Adana": [
      "Seyhan",
      "Ceyhan",
      "Feke",
      "Karaisalı",
      "Karataş",
      "Kozan",
      "Pozantı",
      "Saimbeyli",
      "Tufanbeyli",
      "Yumurtalık",
      "Yüreğir",
      "Aladağ",
      "İmamoğlu",
      "Sarıçam",
      "Çukurova",
      "Diğer"
    ],
    "Adıyaman": [
      "Adıyaman Merkez",
      "Besni",
      "Çelikhan",
      "Gerger",
      "Gölbaşı",
      "Kahta",
      "Samsat",
      "Sincik",
      "Tut",
      "Diğer"
    ],
    "Afyonkarahisar": [
      "Afyonkarahisar Merkez",
      "Bolvadin",
      "Çay",
      "Dazkırı",
      "Dinar",
      "Emirdağ",
      "İhsaniye",
      "Sandıklı",
      "Sinanpaşa",
      "Sultandağı",
      "Şuhut",
      "Başmakçı",
      "Bayat",
      "İscehisar",
      "Çobanlar",
      "Evciler",
      "Hocalar",
      "Kızılören",
      "Diğer"
    ],
    "Ağrı": [
      "Ağrı Merkez",
      "Diyadin",
      "Doğubayazıt",
      "Eleşkirt",
      "Hamur",
      "Patnos",
      "Taşlıçay",
      "Tutak",
      "Diğer"
    ],
    "Amasya": [
      "Amasya Merkez",
      "Göynücek",
      "Gümüşhacıköy",
      "Merzifon",
      "Suluova",
      "Taşova",
      "Hamamözü",
      "Diğer"
    ],
    "Ankara": [
      "Altındağ",
      "Ayaş",
      "Bala",
      "Beypazarı",
      "Çamlıdere",
      "Çankaya",
      "Çubuk",
      "Elmadağ",
      "Güdül",
      "Haymana",
      "Kalecik",
      "Kızılcahamam",
      "Nallıhan",
      "Polatlı",
      "Şereflikoçhisar",
      "Yenimahalle",
      "Gölbaşı",
      "Keçiören",
      "Mamak",
      "Sincan",
      "Kazan",
      "Akyurt",
      "Etimesgut",
      "Evren",
      "Pursaklar",
      "Diğer"
    ],
    "Antalya": [
      "Akseki",
      "Alanya",
      "Elmalı",
      "Finike",
      "Gazipaşa",
      "Gündoğmuş",
      "Kaş",
      "Korkuteli",
      "Kumluca",
      "Manavgat",
      "Serik",
      "Demre",
      "İbradı",
      "Kemer",
      "Aksu",
      "Döşemealtı",
      "Kepez",
      "Konyaaltı",
      "Muratpaşa",
      "Diğer"
    ],
    "Artvin": [
      "Ardanuç",
      "Arhavi",
      "Artvin Merkez",
      "Borçka",
      "Hopa",
      "Şavşat",
      "Yusufeli",
      "Murgul",
      "Diğer"
    ],
    "Aydın": [
      "Bozdoğan",
      "Çine",
      "Germencik",
      "Karacasu",
      "Koçarlı",
      "Kuşadası",
      "Kuyucak",
      "Nazilli",
      "Söke",
      "Sultanhisar",
      "Yenipazar",
      "Buharkent",
      "İncirliova",
      "Karpuzlu",
      "Köşk",
      "Didim",
      "Efeler",
      "Diğer"
    ],
    "Balıkesir": [
      "Ayvalık",
      "Balya",
      "Bandırma",
      "Bigadiç",
      "Burhaniye",
      "Dursunbey",
      "Edremit",
      "Erdik",
      "Gönen",
      "Havran",
      "İvrindi",
      "Kepsut",
      "Manyas",
      "Savaştepe",
      "Sındırgı",
      "Susurluk",
      "Marmara",
      "Gömeç",
      "Altıeylül",
      "Karesi",
      "Diğer"
    ],
    "Bilecik": [
      "Bilecik Merkez",
      "Bozüyük",
      "Gölpazarı",
      "Osmaneli",
      "Pazaryeri",
      "Söğüt",
      "Yenipazar",
      "İnhisar",
      "Diğer"
    ],
    "Bingöl": [
      "Bingöl Merkez",
      "Genç",
      "Karlıova",
      "Kiğı",
      "Solhan",
      "Adaklı",
      "Yayladere",
      "Yedisu",
      "Diğer"
    ],
    "Bitlis": [
      "Adilcevaz",
      "Ahlat",
      "Bitlis Merkez",
      "Hizan",
      "Mutki",
      "Tatvan",
      "Güroymak",
      "Diğer"
    ],
    "Bolu": [
      "Bolu Merkez",
      "Gerede",
      "Göynük",
      "Kıbrıscık",
      "Mengen",
      "Mudurnu",
      "Seben",
      "Dörtdivan",
      "Yeniçağa",
      "Diğer"
    ],
    "Burdur": [
      "Ağlasun",
      "Bucak",
      "Burdur Merkez",
      "Gölhisar",
      "Tefenni",
      "Yeşilova",
      "Karamanlı",
      "Kemer",
      "Altınyayla",
      "Çavdır",
      "Çeltikçi",
      "Diğer"
    ],
    "Bursa": [
      "Gemlik",
      "İnegöl",
      "İznik",
      "Karacabey",
      "Keles",
      "Mudanya",
      "Mustafakemalpaşa",
      "Orhaneli",
      "Orhangazi",
      "Yenişehir",
      "Büyükorhan",
      "Harmancık",
      "Nilüfer",
      "Osmangazi",
      "Yıldırım",
      "Gürsu",
      "Kestel",
      "Diğer"
    ],
    "Çanakkale": [
      "Ayvacık",
      "Bayramiç",
      "Biga",
      "Bozcaada",
      "Çan",
      "Çanakkale Merkez",
      "Eceabat",
      "Ezine",
      "Gelibolu",
      "Gökçeada",
      "Lapseki",
      "Yenice",
      "Diğer"
    ],
    "Çankırı": [
      "Çankırı Merkez",
      "Çerkeş",
      "Eldivan",
      "Ilgaz",
      "Kurşunlu",
      "Orta",
      "Şabanözü",
      "Yapraklı",
      "Atkaracalar",
      "Kızılırmak",
      "Bayramören",
      "Korgun",
      "Diğer"
    ],
    "Çorum": [
      "Alaca",
      "Bayat",
      "Çorum Merkez",
      "İskilip",
      "Kargı",
      "Mecitözü",
      "Ortaköy",
      "Osmancık",
      "Sungurlu",
      "Boğazkale",
      "Uğurludağ",
      "Dodurga",
      "Laçin",
      "Oğuzlar",
      "Diğer"
    ],
    "Denizli": [
      "Acıpayam",
      "Buldan",
      "Çal",
      "Çameli",
      "Çardak",
      "Çivril",
      "Güney",
      "Kale",
      "Sarayköy",
      "Tavas",
      "Babadağ",
      "Bekilli",
      "Honaz",
      "Serinhisar",
      "Pamukkale",
      "Baklan",
      "Beyağaç",
      "Bozkurt",
      "Merkezefendi",
      "Diğer"
    ],
    "Diyarbakır": [
      "Bismil",
      "Çermik",
      "Çınar",
      "Çüngüş",
      "Dicle",
      "Ergani",
      "Hani",
      "Hazro",
      "Kulp",
      "Lice",
      "Silvan",
      "Eğil",
      "Kocaköy",
      "Bağlar",
      "Kayapınar",
      "Sur",
      "Yenişehir",
      "Diğer"
    ],
    "Edirne": [
      "Edirne Merkez",
      "Enez",
      "Havsa",
      "İpsala",
      "Keşan",
      "Lalapaşa",
      "Meriç",
      "Uzunköprü",
      "Süloğlu",
      "Diğer"
    ],
    "Elazığ": [
      "Ağın",
      "Baskil",
      "Elazığ Merkez",
      "Karakoçan",
      "Keban",
      "Maden",
      "Palu",
      "Sivrice",
      "Arıcak",
      "Kovancılar",
      "Alacakaya",
      "Diğer"
    ],
    "Erzincan": [
      "Çayırlı",
      "Erzincan Merkez",
      "İliç",
      "Kemah",
      "Kemaliye",
      "Refahiye",
      "Tercan",
      "Üzümlü",
      "Otlukbeli",
      "Diğer"
    ],
    "Erzurum": [
      "Aşkale",
      "Çat",
      "Hınıs",
      "Horasan",
      "İspir",
      "Karayazı",
      "Narman",
      "Oltu",
      "Olur",
      "Pasinler",
      "Şenkaya",
      "Tekman",
      "Tortum",
      "Karaçoban",
      "Uzundere",
      "Pazaryolu",
      "Aziziye",
      "Köprüköy",
      "Palandöken",
      "Yakutiye",
      "Diğer"
    ],
    "Eskişehir": [
      "Çifteler",
      "Mahmudiye",
      "Mihalıççık",
      "Sarıcakaya",
      "Seyitgazi",
      "Sivrihisar",
      "Alpu",
      "Beylikova",
      "İnönü",
      "Günyüzü",
      "Han",
      "Mihalgazi",
      "Odunpazarı",
      "Tepebaşı",
      "Diğer"
    ],
    "Gaziantep": [
      "Araban",
      "İslahiye",
      "Nizip",
      "Oğuzeli",
      "Yavuzeli",
      "Şahinbey",
      "Şehitkamil",
      "Karkamış",
      "Nurdağı",
      "Diğer"
    ],
    "Giresun": [
      "Alucra",
      "Bulancak",
      "Dereli",
      "Espiye",
      "Eynesil",
      "Giresun Merkez",
      "Görele",
      "Keşap",
      "Şebinkarahisar",
      "Tirebolu",
      "Piraziz",
      "Yağlıdere",
      "Çamoluk",
      "Çanakçı",
      "Doğankent",
      "Güce",
      "Diğer"
    ],
    "Gümüşhane": [
      "Gümüşhane Merkez",
      "Kelkit",
      "Şiran",
      "Torul",
      "Köse",
      "Kürtün",
      "Diğer"
    ],
    "Hakkari": [
      "Çukurca",
      "Hakkari Merkez",
      "Şemdinli",
      "Yüksekova",
      "Diğer"
    ],
    "Hatay": [
      "Altınözü",
      "Dörtyol",
      "Hassa",
      "İskenderun",
      "Kırıkhan",
      "Reyhanlı",
      "Samandağ",
      "Yayladağı",
      "Erzin",
      "Belen",
      "Kumlu",
      "Antakya",
      "Arsuz",
      "Defne",
      "Payas",
      "Diğer"
    ],
    "Isparta": [
      "Atabey",
      "Eğirdir",
      "Gelendost",
      "Isparta Merkez",
      "Keçiborlu",
      "Senirkent",
      "Sütçüler",
      "Şarkikaraağaç",
      "Uluborlu",
      "Yalvaç",
      "Aksu",
      "Gönen",
      "Yenişarbademli",
      "Diğer"
    ],
    "Mersin": [
      "Anamur",
      "Erdemli",
      "Gülnar",
      "Mut",
      "Silifke",
      "Tarsus",
      "Aydıncık",
      "Bozyazı",
      "Çamlıyayla",
      "Akdeniz",
      "Mezitli",
      "Toroslar",
      "Yenişehir",
      "Diğer"
    ],
    "İstanbul": [
      "Adalar",
      "Bakırköy",
      "Beşiktaş",
      "Beykoz",
      "Beyoğlu",
      "Çatalca",
      "Eyüp",
      "Fatih",
      "Gaziosmanpaşa",
      "Kadıköy",
      "Kartal",
      "Sarıyer",
      "Silivri",
      "Şile",
      "Şişli",
      "Üsküdar",
      "Zeytinburnu",
      "Büyükçekmece",
      "Kağıthane",
      "Küçükçekmece",
      "Pendik",
      "Ümraniye",
      "Bayrampaşa",
      "Avcılar",
      "Bağcılar",
      "Bahçelievler",
      "Güngören",
      "Maltepe",
      "Sultanbeyli",
      "Tuzla",
      "Esenler",
      "Arnavutköy",
      "Ataşehir",
      "Başakşehir",
      "Beylikdüzü",
      "Çekmeköy",
      "Esenyurt",
      "Sancaktepe",
      "Sultangazi",
      "Diğer"
    ],
    "İzmir": [
      "Aliağa",
      "Bayındır",
      "Bergama",
      "Bornova",
      "Çeşme",
      "Dikili",
      "Foça",
      "Karaburun",
      "Karşıyaka",
      "Kemalpaşa",
      "Kınık",
      "Kiraz",
      "Menemen",
      "Ödemiş",
      "Seferihisar",
      "Selçuk",
      "Tire",
      "Torbalı",
      "Urla",
      "Beydağ",
      "Buca",
      "Konak",
      "Menderes",
      "Balçova",
      "Çiğli",
      "Gaziemir",
      "Narlıdere",
      "Güzelbahçe",
      "Bayraklı",
      "Karabağlar",
      "Diğer"
    ],
    "Kars": [
      "Arpaçay",
      "Digor",
      "Kağızman",
      "Kars Merkez",
      "Sarıkamış",
      "Selim",
      "Susuz",
      "Akyaka",
      "Diğer"
    ],
    "Kastamonu": [
      "Abana",
      "Araç",
      "Azdavay",
      "Bozkurt",
      "Cide",
      "Çatalzeytin",
      "Daday",
      "Devrekani",
      "İnebolu",
      "Kastamonu Merkez",
      "Küre",
      "Taşköprü",
      "Tosya",
      "İhsangazi",
      "Pınarbaşı",
      "Şenpazar",
      "Ağlı",
      "Doğanyurt",
      "Hanönü",
      "Seydiler",
      "Diğer"
    ],
    "Kayseri": [
      "Bünyan",
      "Develi",
      "Felahiye",
      "İncesu",
      "Pınarbaşı",
      "Sarıoğlan",
      "Sarız",
      "Tomarza",
      "Yahyalı",
      "Yeşilhisar",
      "Akkışla",
      "Talas",
      "Kocasinan",
      "Melikgazi",
      "Hacılar",
      "Özvatan",
      "Diğer"
    ],
    "Kırklareli": [
      "Babaeski",
      "Demirköy",
      "Kırklareli Merkez",
      "Kofçaz",
      "Lüleburgaz",
      "Pehlivanköy",
      "Pınarhisar",
      "Vize",
      "Diğer"
    ],
    "Kırşehir": [
      "Çiçekdağı",
      "Kaman",
      "Kırşehir Merkez",
      "Mucur",
      "Akpınar",
      "Akçakent",
      "Boztepe",
      "Diğer"
    ],
    "Kocaeli": [
      "Gebze",
      "Gölcük",
      "Kandıra",
      "Karamürsel",
      "Körfez",
      "Derince",
      "Başiskele",
      "Çayırova",
      "Darıca",
      "Dilovası",
      "İzmit",
      "Kartepe",
      "Diğer"
    ],
    "Konya": [
      "Akşehir",
      "Beyşehir",
      "Bozkır",
      "Cihanbeyli",
      "Çumra",
      "Doğanhisar",
      "Ereğli",
      "Hadim",
      "Ilgın",
      "Kadınhanı",
      "Karapınar",
      "Kulu",
      "Sarayönü",
      "Seydişehir",
      "Yunak",
      "Akören",
      "Altınekin",
      "Derebucak",
      "Hüyük",
      "Karatay",
      "Meram",
      "Selçuklu",
      "Taşkent",
      "Ahırlı",
      "Çeltik",
      "Derbent",
      "Emirgazi",
      "Güneysınır",
      "Halkapınar",
      "Tuzlukçu",
      "Yalıhüyük",
      "Diğer"
    ],
    "Kütahya": [
      "Altıntaş",
      "Domaniç",
      "Emet",
      "Gediz",
      "Kütahya Merkez",
      "Simav",
      "Tavşanlı",
      "Aslanapa",
      "Dumlupınar",
      "Hisarcık",
      "Şaphane",
      "Çavdarhisar",
      "Pazarlar",
      "Diğer"
    ],
    "Malatya": [
      "Akçadağ",
      "Arapgir",
      "Arguvan",
      "Darende",
      "Doğanşehir",
      "Hekimhan",
      "Pütürge",
      "Yeşilyurt",
      "Battalgazi",
      "Doğanyol",
      "Kale",
      "Kuluncak",
      "Yazıhan",
      "Diğer"
    ],
    "Manisa": [
      "Akhisar",
      "Alaşehir",
      "Demirci",
      "Gördes",
      "Kırkağaç",
      "Kula",
      "Salihli",
      "Sarıgöl",
      "Saruhanlı",
      "Selendi",
      "Soma",
      "Turgutlu",
      "Ahmetli",
      "Gölmarmara",
      "Köprübaşı",
      "Şehzadeler",
      "Yunusemre",
      "Diğer"
    ],
    "Kahramanmaraş": [
      "Afşin",
      "Andırın",
      "Elbistan",
      "Göksun",
      "Pazarcık",
      "Türkoğlu",
      "Çağlayancerit",
      "Ekinözü",
      "Nurhak",
      "Dulkadiroğlu",
      "Onikişubat",
      "Diğer"
    ],
    "Mardin": [
      "Derik",
      "Kızıltepe",
      "Mazıdağı",
      "Midyat",
      "Nusaybin",
      "Ömerli",
      "Savur",
      "Dargeçit",
      "Yeşilli",
      "Artuklu",
      "Diğer"
    ],
    "Muğla": [
      "Bodrum",
      "Datça",
      "Fethiye",
      "Köyceğiz",
      "Marmaris",
      "Milas",
      "Ula",
      "Yatağan",
      "Dalaman",
      "Ortaca",
      "Kavaklıdere",
      "Menteşe",
      "Seydikemer",
      "Diğer"
    ],
    "Muş": [
      "Bulanık",
      "Malazgirt",
      "Muş Merkez",
      "Varto",
      "Hasköy",
      "Korkut",
      "Diğer"
    ],
    "Nevşehir": [
      "Avanos",
      "Derinkuyu",
      "Gülşehir",
      "Hacıbektaş",
      "Kozaklı",
      "Nevşehir Merkez",
      "Ürgüp",
      "Acıgöl",
      "Diğer"
    ],
    "Niğde": [
      "Bor",
      "Çamardı",
      "Niğde Merkez",
      "Ulukışla",
      "Altunhisar",
      "Çiftlik",
      "Diğer"
    ],
    "Ordu": [
      "Akkuş",
      "Aybastı",
      "Fatsa",
      "Gölköy",
      "Korgan",
      "Kumru",
      "Mesudiye",
      "Perşembe",
      "Ulubey",
      "Ünye",
      "Gülyalı",
      "Gürgentepe",
      "Çamaş",
      "Çatalpınar",
      "Çaybaşı",
      "İkizce",
      "Kabadüz",
      "Kabataş",
      "Altınordu",
      "Diğer"
    ],
    "Rize": [
      "Ardeşen",
      "Çamlıhemşin",
      "Çayeli",
      "Fındıklı",
      "İkizdere",
      "Kalkandere",
      "Pazar",
      "Rize Merkez",
      "Güneysu",
      "Derepazarı",
      "Hemşin",
      "İyidere",
      "Diğer"
    ],
    "Sakarya": [
      "Akyazı",
      "Geyve",
      "Hendek",
      "Karasu",
      "Kaynarca",
      "Sapanca",
      "Kocaali",
      "Pamukova",
      "Taraklı",
      "Ferizli",
      "Karapürçek",
      "Söğütlü",
      "Adapazarı",
      "Arifiye",
      "Erenler",
      "Serdivan",
      "Diğer"
    ],
    "Samsun": [
      "Alaçam",
      "Bafra",
      "Çarşamba",
      "Havza",
      "Kavak",
      "Ladik",
      "Terme",
      "Vezirköprü",
      "Asarcık",
      "19.Mayıs",
      "Salıpazarı",
      "Tekkeköy",
      "Ayvacık",
      "Yakakent",
      "Atakum",
      "Canik",
      "İlkadım",
      "Diğer"
    ],
    "Siirt": [
      "Baykan",
      "Eruh",
      "Kurtalan",
      "Pervari",
      "Siirt Merkez",
      "Şirvan",
      "Tillo",
      "Diğer"
    ],
    "Sinop": [
      "Ayancık",
      "Boyabat",
      "Durağan",
      "Erfelek",
      "Gerze",
      "Sinop Merkez",
      "Türkeli",
      "Dikmen",
      "Saraydüzü",
      "Diğer"
    ],
    "Sivas": [
      "Divriği",
      "Gemerek",
      "Gürün",
      "Hafik",
      "İmranlı",
      "Kangal",
      "Koyulhisar",
      "Sivas Merkez",
      "Suşehri",
      "Şarkışla",
      "Yıldızeli",
      "Zara",
      "Akıncılar",
      "Altınyayla",
      "Doğanşar",
      "Gölova",
      "Ulaş",
      "Diğer"
    ],
    "Tekirdağ": [
      "Çerkezköy",
      "Çorlu",
      "Hayrabolu",
      "Malkara",
      "Muratlı",
      "Saray",
      "Şarköy",
      "Marmaraereğlisi",
      "Ergene",
      "Kapaklı",
      "Süleymanpaşa",
      "Diğer"
    ],
    "Tokat": [
      "Almus",
      "Artova",
      "Erbaa",
      "Niksar",
      "Reşadiye",
      "Tokat Merkez",
      "Turhal",
      "Zile",
      "Pazar",
      "Yeşilyurt",
      "Başçiftlik",
      "Sulusaray",
      "Diğer"
    ],
    "Trabzon": [
      "Akçaabat",
      "Araklı",
      "Arsin",
      "Çaykara",
      "Maçka",
      "Of",
      "Sürmene",
      "Tonya",
      "Vakfıkebir",
      "Yomra",
      "Beşikdüzü",
      "Şalpazarı",
      "Çarşıbaşı",
      "Dernekpazarı",
      "Düzköy",
      "Hayrat",
      "Köprübaşı",
      "Ortahisar",
      "Çemişgezek",
      "Hozat",
      "Mazgirt",
      "Nazımiye",
      "Ovacık",
      "Pertek",
      "Pülümür",
      "Tunceli Merkez",
      "Diğer"
    ],
    "Şanlıurfa": [
      "Akçakale",
      "Birecik",
      "Bozova",
      "Ceylanpınar",
      "Halfeti",
      "Hilvan",
      "Siverek",
      "Suruç",
      "Viranşehir",
      "Harran",
      "Eyyübiye",
      "Haliliye",
      "Karaköprü",
      "Diğer"
    ],
    "Uşak": [
      "Banaz",
      "Eşme",
      "Karahallı",
      "Sivaslı",
      "Ulubey",
      "Uşak Merkez",
      "Diğer"
    ],
    "Van": [
      "Başkale",
      "Çatak",
      "Erciş",
      "Gevaş",
      "Gürpınar",
      "Muradiye",
      "Özalp",
      "Bahçesaray",
      "Çaldıran",
      "Edremit",
      "Saray",
      "İpekyolu",
      "Tuşba",
      "Diğer"
    ],
    "Yozgat": [
      "Akdağmadeni",
      "Boğazlıyan",
      "Çayıralan",
      "Çekerek",
      "Sarıkaya",
      "Sorgun",
      "Şefaatli",
      "Yerköy",
      "Yozgat Merkez",
      "Aydıncık",
      "Çandır",
      "Kadışehri",
      "Saraykent",
      "Yenifakılı",
      "Diğer"
    ],
    "Zonguldak": [
      "Çaycuma",
      "Devrek",
      "Ereğli",
      "Zonguldak Merkez",
      "Alaplı",
      "Gökçebey",
      "Kilimli",
      "Kozlu",
      "Diğer"
    ],
    "Aksaray": [
      "Aksaray Merkez",
      "Ortaköy",
      "Ağaçören",
      "Güzelyurt",
      "Sarıyahşi",
      "Eskil",
      "Gülağaç",
      "Diğer"
    ],
    "Bayburt": [
      "Bayburt Merkez",
      "Aydıntepe",
      "Demirözü",
      "Diğer"
    ],
    "Karaman": [
      "Ermenek",
      "Karaman Merkez",
      "Ayrancı",
      "Kazımkarabekir",
      "Başyayla",
      "Sarıveliler",
      "Diğer"
    ],
    "Kırıkkale": [
      "Delice",
      "Keskin",
      "Kırıkkale Merkez",
      "Sulakyurt",
      "Bahşili",
      "Balışeyh",
      "Çelebi",
      "Karakeçili",
      "Yahşihan",
      "Diğer"
    ],
    "Batman": [
      "Batman Merkez",
      "Beşiri",
      "Gercüş",
      "Kozluk",
      "Sason",
      "Hasankeyf",
      "Diğer"
    ],
    "Şırnak": [
      "Beytüşşebap",
      "Cizre",
      "İdil",
      "Silopi",
      "Şırnak Merkez",
      "Uludere",
      "Güçlükonak",
      "Diğer"
    ],
    "Bartın": [
      "Bartın Merkez",
      "Kurucaşile",
      "Ulus",
      "Amasra",
      "Diğer"
    ],
    "Ardahan": [
      "Ardahan Merkez",
      "Çıldır",
      "Göle",
      "Hanak",
      "Posof",
      "Damal",
      "Diğer"
    ],
    "Iğdır": [
      "Aralık",
      "Iğdır Merkez",
      "Tuzluca",
      "Karakoyunlu",
      "Diğer"
    ],
    "Yalova": [
      "Yalova Merkez",
      "Altınova",
      "Armutlu",
      "Çınarcık",
      "Çiftlikköy",
      "Termal",
      "Diğer"
    ],
    "Karabük": [
      "Eflani",
      "Eskipazar",
      "Karabük Merkez",
      "Ovacık",
      "Safranbolu",
      "Yenice",
      "Diğer"
    ],
    "Kilis": [
      "Kilis Merkez",
      "Elbeyli",
      "Musabeyli",
      "Polateli",
      "Diğer"
    ],
    "Osmaniye": [
      "Bahçe",
      "Kadirli",
      "Osmaniye Merkez",
      "Düziçi",
      "Hasanbeyli",
      "Sumbas",
      "Toprakkale",
      "Diğer"
    ],
    "Düzce": [
      "Akçakoca",
      "Düzce Merkez",
      "Yığılca",
      "Cumayeri",
      "Gölyaka",
      "Çilimli",
      "Gümüşova",
      "Kaynaşlı",
      "Diğer"
    ]
  };

      this.ilceler = ilcelerData[this.contactInfo.il] || [];
      this.contactInfo.ilce = ""; // İl değiştiğinde ilçe seçimini sıfırla
    },
    validateIban() {
      const iban = this.bankaBilgileri.iban.trim();
      if (iban.length === 26) {
        const regex = /^TR\d{24}$/;
        this.ibanIsValid = regex.test(iban);
      } else {
        this.ibanIsValid = false;
      }
    },
    validateKimlikNumarasi() {
      const kimlik = this.bankaBilgileri.kimlikNumarasi.trim();
      if (kimlik.length === 11) {
        const regex = /^\d{11}$/;
        this.kimlikNumarasiIsValid = regex.test(kimlik);
      } else {
        this.kimlikNumarasiIsValid = false;
      }
    },
    sanitizeFileName(name) {
      // Dosya adında kullanılmaması gereken karakterleri temizler.
      return name.replace(/[^a-z0-9]/gi, '_').toLowerCase();
    },
    base64ToBlob(base64) {
      const byteString = atob(base64.split(',')[1]);
      const mimeString = base64.split(',')[0].split(':')[1].split(';')[0];
      const ab = new ArrayBuffer(byteString.length);
      const ia = new Uint8Array(ab);
      for (let i = 0; i < byteString.length; i++) {
        ia[i] = byteString.charCodeAt(i);
      }
      return new Blob([ab], { type: mimeString });
    },
    async submitForm() {
  if (
    this.currentStep === 8 &&
    this.isCalismaBilgileriComplete &&
    this.isBankaBilgileriValid
  ) {
    // Kullanıcının isim ve soyadının dolu olduğundan emin olun
    const { isim, soyad } = this.personalInfo;
    if (!isim.trim() || !soyad.trim()) {
      alert('Lütfen İsim ve Soyad alanlarını doldurun.');
      return;
    }

    // Tüm form verilerini birleştirin
    const gizliMusteriRequest = {
      ...this.personalInfo,
      ...this.contactInfo,
      ...this.educationInfo,
      ...this.ozelBilgiler,
      ...this.calismaBilgileri,
      ...this.bankaBilgileri,
    };

    // FormData nesnesi oluşturun
    const formData = new FormData();

    // Form verilerini ekleyin
    for (const key in gizliMusteriRequest) {
      formData.append(key, gizliMusteriRequest[key]);
    }

    // Fotoğrafı ekleyin (ismini ve türünü front-end'de belirlemeyin)
    if (this.photo) {
      const blob = this.base64ToBlob(this.photo);
      
      // MIME türünü kontrol et
      if (blob.type !== 'image/jpeg' && blob.type !== 'image/jpg') {
        alert('Yalnızca JPEG formatında fotoğraflar yükleyebilirsiniz.');
        return;
      }

      const file = new File([blob], 'fotoğraf.jpeg', { type: 'image/jpeg' }); // Sabit bir isim ve tür belirleyin
      formData.append('file', file);
    }

    try {
      // API isteğini doğru backend URL'sine gönderin
      const response = await axios.post('http://localhost:8080/api/gizli-musteri/kaydet', formData, {
        headers: {
          'Content-Type': 'multipart/form-data',
        },
      });

      // Başarılı yanıt durumunda yapılacaklar
      alert('Form başarıyla gönderildi!');
      console.log('Yanıt:', response.data);

      // İsteğe bağlı: Formu sıfırlama
      this.resetForm();
    } catch (error) {
      // Hata durumunda yapılacaklar
      console.error('Form gönderimi sırasında hata oluştu:', error);
      alert('Form gönderimi sırasında bir hata oluştu. Lütfen tekrar deneyin.');
    }
  } else {
    alert('Lütfen tüm zorunlu alanları doğru şekilde doldurunuz.');
  }
},
    resetForm() {
      // Tüm form verilerini sıfırlayın
      this.sozlesmeOnay = false;
      this.kabulOnay = false;
      this.photo = null;
      this.currentStep = 1;
      this.personalInfo = {
        isim: "",
        soyad: "",
        dogumYeri: "",
        dogumTarihi: "",
        medeniDurum: "",
        cocukSayisi: "",
      };
      this.contactInfo = {
        acikAdres: "",
        semt: "",
        il: "",
        ilce: "",
        evTelefonu: "",
        isTelefonu: "",
        mobilTelefon: "",
        email: "",
        emailConfirm: "",
      };
      this.educationInfo = {
        egitimDurumu: "",
        bildigiYabanciDiller: "",
        universiteBilgileri: "",
        calismaDurumu: "",
        calistigiSektor: "",
      };
      this.ozelBilgiler = {
        boyBedenBilgileri: "",
        gozlukKullaniyorMu: "",
        lensKullaniyorMu: "",
        ehliyetVarMi: "",
        aktifAracKullaniyorMu: "",
        otomobilVarMi: "",
        cekirdekAileGeliri: "",
        hobiler: "",
        sigaraKullaniyorMu: "", // Burada sigara kullanımı eklenmiş
      };
      this.calismaBilgileri = {
        dahaOnceGizliMusteri: "",
        calisabilecegiZamanDilimi: "",
        calisabilecegiBolgeler: "",
      };
      this.bankaBilgileri = {
        tamAliciAdi: "",
        iban: "",
        kimlikNumarasi: "",
      };
      this.ilceler = [];
      this.dateIsValid = true;
      this.ibanIsValid = true;
      this.kimlikNumarasiIsValid = true;
    },
  },
  beforeDestroy() {
    // Sayfadan çıkarken kamerayı kapat
    this.stopCamera();
  },
  beforeRouteLeave(to, from, next) {
    // Route değiştiğinde kamerayı kapat
    this.stopCamera();
    next();
  },
};
</script>
<style scoped>
.gizli-musteri-container {
  padding: 5%;
  background-color: #f7f7f7;
  border-radius: 8px;
  max-width: 90%;
  margin: auto;
}

h1 {
  font-size: 2em;
  margin-bottom: 1em;
  color: #333;
}

h2 {
  font-size: 1.5em;
  margin-top: 1em;
  color: #555;
}

p {
  font-size: 1em;
  margin-bottom: 2%;
}

label {
  display: block;
  margin-bottom: 2%;
  font-size: 1em;
}

input[type="text"],
input[type="email"],
input[type="number"],
select,
textarea {
  width: 100%;
  padding: 1%;
  margin-top: 0.5%;
  box-sizing: border-box;
}

textarea {
  resize: vertical;
  min-height: 60px;
}

button {
  padding: 1.5% 3%;
  background-color: #007bff;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  margin-right: 10px;
}

button:disabled {
  background-color: #cccccc;
  cursor: not-allowed;
}

.video-preview,
.canvas-preview {
  width: 100%;
  max-width: 100%;
  border: 1px solid #ccc;
  margin-bottom: 10px;
}

img {
  max-width: 100%;
  margin-top: 10px;
}

.error-message {
  color: red;
  font-size: 0.9em;
  margin-top: -1.5%;
  margin-bottom: 2%;
  display: block;
}

.optional-note {
  font-size: 0.9em;
  color: #555;
  margin-bottom: 1em;
}

/* Scrollable Text İçin Stil */
.scrollable-text {
  max-height: 300px; /* İhtiyaca göre ayarlanabilir */
  overflow-y: scroll; /* Dikey kaydırma */
  padding: 1em;
  background-color: #f0f0f0;
  border: 1px solid #ddd;
  border-radius: 8px;
}

/* Önemli Metinlerin Vurgulanması */
.important {
  font-weight: bold;
  color: #d9534f; /* Kırmızı tonlarında vurgulama */
}

/* Responsive Tasarım */
@media (max-width: 768px) {
  .gizli-musteri-container {
    padding: 8%;
    max-width: 100%;
  }

  h1 {
    font-size: 1.5em;
  }

  h2 {
    font-size: 1.2em;
  }

  p,
  label {
    font-size: 0.9em;
  }

  button {
    padding: 2% 4%;
    font-size: 1em;
  }

  .scrollable-text {
    max-height: 40vh; /* Daha geniş kaydırılabilir alan */
    padding: 2%;
  }

  .video-preview,
  .canvas-preview {
    width: 100%;
  }
}

@media (max-width: 480px) {
  .gizli-musteri-container {
    padding: 10%;
    max-width: 100%;
  }

  h1 {
    font-size: 1.2em;
  }

  h2 {
    font-size: 1em;
  }

  p,
  label {
    font-size: 0.85em;
  }

  button {
    padding: 3% 6%;
    font-size: 0.85em;
  }

  .scrollable-text {
    max-height: 50vh;
    padding: 4%;
  }
}
</style>
<!--Guncel 15.10.2024-->